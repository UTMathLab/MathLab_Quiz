import{g as z,s as U,_ as Y,a as H,b as J}from"./DeegIuxU.js";import{i as K,g as W,a as X,d as $,b as Z,c as B,q as ee,w as ae,o as E,l as le,e as ne}from"./CCgwrcwB.js";import{d as te,r as t,n as oe,o as ue,R as se,x as L,B as re,O as N,P as R,g as ce,y as b}from"./OpAaggL_.js";import"./CexE7mKb.js";const ve={key:3,class:"loading-quiz-overlay"},_e=te({__name:"index",setup(ie){const j=K({apiKey:"AIzaSyCNCFq6bjmPkrNjnNy-pm4JTyoIIIb7G6I",authDomain:"mathlab-quiz.firebaseapp.com",projectId:"mathlab-quiz",storageBucket:"mathlab-quiz.firebasestorage.app",messagingSenderId:"15973731988",appId:"1:15973731988:web:02e3f5fd0848dfb784ae81",measurementId:"G-4XGRENY9QF"}),k=W(j),s=t("menu"),I=t(!0),x=t(!1),r=t([]),c=t([]);oe().public.quizDataUrl;let m=null;ue(async()=>{C(),I.value=!0;try{const e=["level-0","level-1","level-2","level-3","level-4","level-5"].map(n=>X($(k,"quizzes",n))),l=await Promise.all(e),u=[];l.forEach(n=>{n.exists()?u.push(n.data().data):(console.error(`Error: Document ${n.id} not found!`),u.push([]))}),r.value=u;const i=r.value.map(n=>Array.from({length:n.length},(p,y)=>y));c.value=i.map(n=>z(n,n.length))}catch(a){console.error("Failed to fetch quiz data from Firestore:",a)}finally{I.value=!1}}),se(()=>{m&&clearInterval(m)});const G=a=>{const e=a.getFullYear(),l=a.getMonth()+1,u=a.getDate(),i=a.getHours(),n=a.getMinutes(),p=a.getSeconds(),y=e*1e10+l*1e8+u*1e6+i*1e4+n*100+p;return{year:e,month:l,day:u,hour:i,minute:n,sortdata:y}},o=t(0),P=[["6級","小中学生初級","制限時間：60秒"],["5級","小中学生上級","制限時間：60秒"],["4級","高校生初級","制限時間：60秒"],["3級","高校生上級","制限時間：60秒"],["2級","大学生初級","制限時間：60秒"],["1級","大学生上級","制限時間：60秒"]],g=t([]),A=async(a,e=null)=>{x.value=!0,g.value=[];try{const l=ee(B(k,"kf75"),ae("level","==",a),E("score","desc"),E("when.sortdata","asc"),le(6)),u=await ne(l),i=[];u.forEach(n=>{const p=n.data();let y="black";e&&p.when.sortdata===e.when.sortdata&&p.score===e.score&&(y="red"),i.push({score:p.score,when:p.when,color:y})}),g.value=i}catch(l){console.error("Firebaseの読み込みエラー:",l),g.value=[]}finally{x.value=!1}},F=async()=>{if(s.value!=="question")return;m&&(clearInterval(m),m=null),s.value="result",f.value=60;const a=new Date,e={level:o.value,score:h.value,when:G(a)};try{await Z(B(k,"kf75"),e)}catch(l){console.error("Firebaseへの書き込みエラー:",l)}finally{await A(e.level,e)}},Q=a=>{if(I.value||r.value.length===0)return;o.value=a,s.value="question";const e=r.value.map(l=>Array.from({length:l.length},(u,i)=>i));c.value=e.map(l=>z(l,l.length)),f.value=60,D.value=Date.now(),A(o.value)},v=t(0),h=t(0),_=t(0),T=t(null),f=t(60),d=t(!1),q=t(!1),w=t(!1),D=t(0),S=t(0),C=()=>{m=U(()=>{if(s.value==="question"){if(f.value<=_.value*5){s.value==="question"&&F();return}f.value>0&&f.value--}},1e3)},M=a=>{if(d.value===!0||s.value!=="question")return;if(S.value=Date.now(),d.value=!0,a)h.value++,T.value="正解！",q.value=!0;else if(_.value++,T.value="不正解",w.value=!0,f.value<=_.value*5){s.value==="question"&&F();return}const e=()=>{s.value==="question"&&d.value===!0&&(v.value++,D.value=Date.now(),d.value=!1,q.value=!1,w.value=!1)};S.value<D.value+2e3?setTimeout(e,3e3+D.value-S.value):setTimeout(e,1e3)},V=()=>{m&&clearInterval(m),s.value="menu",v.value=0,h.value=0,_.value=0;const a=r.value.map(e=>Array.from({length:e.length},(l,u)=>u));c.value=a.map(e=>z(e,e.length)),g.value=[],d.value=!1,q.value=!1,w.value=!1,C()},O=()=>{m&&clearInterval(m),s.value="menu",v.value=0,h.value=0,_.value=0;const a=r.value.map(e=>Array.from({length:e.length},(l,u)=>u));c.value=a.map(e=>z(e,e.length)),g.value=[],d.value=!1,q.value=!1,w.value=!1,C()};return(a,e)=>{const l=ce("a-background"),u=J,i=Y,n=H;return b(),L("div",null,[re(l),s.value==="menu"?(b(),N(u,{key:0,onSelect:Q,Levels:P})):s.value==="question"&&r.value.length>0?(b(),N(i,{key:1,count:f.value-_.value*5,correctIndex:r.value[o.value][c.value[o.value][v.value]].answer,quizIndex:v.value,quizNumber:c.value[o.value][v.value],correctNumber:h.value,answerDisplay:d.value,correctDisplay:q.value,incorrectDisplay:w.value,question:r.value[o.value][c.value[o.value][v.value]].question,options:r.value[o.value][c.value[o.value][v.value]].options,fontSize:r.value[o.value][c.value[o.value][v.value]].fontSize,answer:r.value[o.value][c.value[o.value][v.value]].options[r.value[o.value][c.value[o.value][v.value]].answer],onSelect:M,onTimeout:a.timeout,onQuit:O},null,8,["count","correctIndex","quizIndex","quizNumber","correctNumber","answerDisplay","correctDisplay","incorrectDisplay","question","options","fontSize","answer","onTimeout"])):s.value==="result"?(b(),N(n,{key:2,"correct-count":h.value,ranking:g.value,"is-loading":x.value,onSelect:V},null,8,["correct-count","ranking","is-loading"])):R("",!0),I.value?(b(),L("div",ve," クイズデータを読み込んでいます... ")):R("",!0)])}}});export{_e as default};
